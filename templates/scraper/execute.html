{% extends "base.html" %}

{% block title %}Scraper Execute Operations{% endblock %}
{% block page_title %}Scraper Execute Operations{% endblock %}

{% block content %}
<div class="row g-4 mb-4">
    <div class="col-lg-8">
        <div class="card modern-card">
            <div class="card-header">
                <div class="d-flex align-items-center">
                    <i class="bi bi-robot text-primary me-2"></i>
                    <h5 class="mb-0">Scraper Configuration</h5>
                </div>
            </div>
            <div class="card-body">
                <div class="row g-3 mb-4">
                    <div class="col-md-4">
                        <label class="form-label fw-medium">
                            <i class="bi bi-gear text-primary me-2"></i>Scraper Type
                        </label>
                        <select id="scraperType" class="form-select">
                            <option value="adsy">Adsy</option>
                            <option value="icopify">Icopify</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label fw-medium">
                            <i class="bi bi-play-circle text-success me-2"></i>Start Page
                        </label>
                        <input type="number" id="startPage" class="form-control" value="1" min="1">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label fw-medium">
                            <i class="bi bi-layers text-info me-2"></i>Pages to Scrape
                        </label>
                        <input type="number" id="pagesToScrape" class="form-control" value="10" min="1" max="100">
                    </div>
                </div>

                <div class="bg-light rounded p-3 mb-4">
                    <div class="d-flex align-items-center mb-2">
                        <i class="bi bi-info-circle text-primary me-2"></i>
                        <strong class="small">Configuration Summary</strong>
                    </div>
                    <div class="small text-muted" id="configSummary">
                        Ready to scrape Adsy pages 1-10 (10 pages total)
                    </div>
                </div>
                
                <div class="row g-2">
                    <div class="col-md-6">
                        <button class="btn btn-success w-100" id="startScrapeBtn" onclick="startScraping()">
                            <i class="bi bi-play-fill me-2"></i>Start Scraping
                        </button>
                    </div>
                    <div class="col-md-6">
                        <button class="btn btn-danger w-100" id="stopScrapeBtn" onclick="stopScraping()" disabled>
                            <i class="bi bi-stop-fill me-2"></i>Stop Scraping
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <div class="card modern-card h-100">
            <div class="card-header">
                <div class="d-flex align-items-center">
                    <i class="bi bi-activity text-info me-2"></i>
                    <h5 class="mb-0">Scraper Status</h5>
                </div>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <div class="d-flex align-items-center justify-content-between">
                        <span class="fw-medium">Status</span>
                        <span id="scrapeStatusText" class="badge bg-secondary">Idle</span>
                    </div>
                </div>
                
                <div id="scrapeProgress" style="display: none;">
                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-1">
                            <small class="text-muted">Progress</small>
                            <small class="text-muted" id="progressPercentage">0%</small>
                        </div>
                        <div class="progress mb-2">
                            <div id="progressBar" class="progress-bar bg-primary progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <div class="row g-2 mb-3">
                        <div class="col-6">
                            <div class="text-center">
                                <div class="h5 text-primary mb-0" id="currentPage">-</div>
                                <small class="text-muted">Current Page</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="text-center">
                                <div class="h5 text-success mb-0" id="recordsScraped">0</div>
                                <small class="text-muted">Records Scraped</small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="border-top pt-3 mt-3">
                    <h6 class="mb-3">
                        <i class="bi bi-bar-chart text-success me-2"></i>Quick Stats
                    </h6>
                    <div class="small">
                        <div class="d-flex justify-content-between align-items-center mb-2 p-2 bg-light rounded">
                            <span class="fw-medium">Total Records:</span>
                            <span class="badge bg-primary">{{ scraped_data|length }}</span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-2 p-2 bg-light rounded">
                            <span class="fw-medium">Adsy Records:</span>
                            <span class="badge bg-success">{{ scraped_data|selectattr('source', 'equalto', 'adsy')|list|length }}</span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center p-2 bg-light rounded">
                            <span class="fw-medium">Icopify Records:</span>
                            <span class="badge bg-info">{{ scraped_data|selectattr('source', 'equalto', 'icopify')|list|length }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row g-4 mb-4">
    <div class="col-12">
        <div class="card modern-card">
            <div class="card-header">
                <div class="d-flex align-items-center justify-content-between">
                    <div class="d-flex align-items-center">
                        <i class="bi bi-terminal text-success me-2"></i>
                        <h5 class="mb-0">Live Scraping Logs</h5>
                    </div>
                    <div class="btn-group btn-group-sm">
                        <button class="btn btn-outline-secondary" onclick="clearScrapeLogs()">
                            <i class="bi bi-trash me-1"></i>Clear
                        </button>
                        <button class="btn btn-outline-primary" id="autoScrollBtn" onclick="toggleAutoScroll()">
                            <i class="bi bi-arrow-down me-1"></i>Auto-scroll
                        </button>
                    </div>
                </div>
            </div>
            <div class="card-body p-0">
                <div id="scrapeLogsContainer" class="logs-terminal">
                    <div class="log-entry info p-3 text-muted">
                        <i class="bi bi-info-circle me-2"></i>Scraper logs will appear here when operations start...
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row g-4">
    <div class="col-lg-6">
        <div class="card modern-card h-100">
            <div class="card-header">
                <div class="d-flex align-items-center">
                    <i class="bi bi-clock-history text-warning me-2"></i>
                    <h5 class="mb-0">Recent Sessions</h5>
                </div>
            </div>
            <div class="card-body">
                {% if recent_sessions %}
                <div class="table-responsive">
                    <table class="table table-sm table-hover sessions-table">
                        <thead class="table-light">
                            <tr>
                                <th class="border-0">Source</th>
                                <th class="border-0">Pages</th>
                                <th class="border-0">Records</th>
                                <th class="border-0">Status</th>
                                <th class="border-0">Time</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for session in recent_sessions[:8] %}
                            <tr class="session-row">
                                <td>
                                    <span class="badge {% if session.source == 'adsy' %}bg-success{% else %}bg-info{% endif %} badge-sm">
                                        {{ session.source.title() }}
                                    </span>
                                </td>
                                <td class="fw-medium">{{ session.start_page }}-{{ session.start_page + session.pages_to_scrape - 1 }}</td>
                                <td>
                                    <span class="text-success fw-bold">{{ session.records_scraped }}</span>
                                </td>
                                <td>
                                    <span class="badge badge-sm {% if session.status == 'completed' %}bg-success{% elif session.status == 'running' %}bg-primary{% elif session.status == 'failed' %}bg-danger{% else %}bg-secondary{% endif %}">
                                        {{ session.status.title() }}
                                    </span>
                                </td>
                                <td class="text-muted small">{{ session.started_at.strftime('%m/%d %H:%M') }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-4 empty-state">
                    <i class="bi bi-clock-history display-4 text-muted mb-3"></i>
                    <h5 class="text-muted">No Recent Sessions</h5>
                    <p class="text-muted mb-3">Start scraping to see session history</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="col-lg-6">
        <div class="card modern-card h-100">
            <div class="card-header">
                <div class="d-flex align-items-center">
                    <i class="bi bi-gear-wide text-secondary me-2"></i>
                    <h5 class="mb-0">Advanced Options</h5>
                </div>
            </div>
            <div class="card-body">
                <div class="options-section">
                    <div class="option-item mb-3" onclick="toggleOption('skipExisting')">
                        <input type="checkbox" id="skipExisting" class="d-none" checked>
                        <div class="d-flex align-items-center">
                            <div class="option-check me-3">
                                <i class="bi bi-check"></i>
                            </div>
                            <i class="bi bi-skip-forward text-info me-2"></i>
                            <div>
                                <div class="fw-medium">Skip existing URLs</div>
                                <small class="text-muted">Avoid duplicate entries</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="option-item mb-3" onclick="toggleOption('respectSuppression')">
                        <input type="checkbox" id="respectSuppression" class="d-none" checked>
                        <div class="d-flex align-items-center">
                            <div class="option-check me-3">
                                <i class="bi bi-check"></i>
                            </div>
                            <i class="bi bi-shield-check text-warning me-2"></i>
                            <div>
                                <div class="fw-medium">Respect suppression list</div>
                                <small class="text-muted">Skip suppressed domains</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-medium">
                            <i class="bi bi-stopwatch text-primary me-2"></i>Delay between pages
                        </label>
                        <div class="input-group">
                            <input type="number" id="pageDelay" class="form-control" value="2" min="1" max="10">
                            <span class="input-group-text">seconds</span>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="form-label fw-medium">
                            <i class="bi bi-arrow-repeat text-success me-2"></i>Max retries per page
                        </label>
                        <input type="number" id="maxRetries" class="form-control" value="3" min="1" max="5">
                    </div>
                </div>
                
                <div class="border-top pt-3">
                    <div class="d-grid gap-2">
                        <button class="btn btn-outline-primary" onclick="exportRecentData()">
                            <i class="bi bi-download me-2"></i>Export Recent Data
                        </button>
                        <button class="btn btn-outline-warning" onclick="viewFailedSessions()">
                            <i class="bi bi-exclamation-triangle me-2"></i>View Failed Sessions
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="failedSessionsModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-warning text-white">
                <h5 class="modal-title">
                    <i class="bi bi-exclamation-triangle me-2"></i>Failed Scraping Sessions
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="failedSessionsContent">
                <div class="text-center py-3">
                    <div class="spinner-border text-warning" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle me-1"></i>Close
                </button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="statsModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title">
                    <i class="bi bi-graph-up me-2"></i>Scraping Statistics
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="statsContent">
                <div class="text-center py-3">
                    <div class="spinner-border text-info" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle me-1"></i>Close
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
let scrapeUpdateInterval;
let autoScroll = true;

function updateConfigSummary() {
    const scraperType = document.getElementById('scraperType').value;
    const startPage = document.getElementById('startPage').value;
    const pagesToScrape = document.getElementById('pagesToScrape').value;
    const endPage = parseInt(startPage) + parseInt(pagesToScrape) - 1;
    
    document.getElementById('configSummary').textContent = 
        `Ready to scrape ${scraperType.charAt(0).toUpperCase() + scraperType.slice(1)} pages ${startPage}-${endPage} (${pagesToScrape} pages total)`;
}

function startScraping() {
    const scraperType = document.getElementById('scraperType').value;
    const startPage = parseInt(document.getElementById('startPage').value);
    const pagesToScrape = parseInt(document.getElementById('pagesToScrape').value);

    fetch('/scraper/start-scraping', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            source: scraperType,
            start_page: startPage,
            pages_to_scrape: pagesToScrape,
            skip_existing: document.getElementById('skipExisting').checked,
            respect_suppression: document.getElementById('respectSuppression').checked,
            page_delay: parseInt(document.getElementById('pageDelay').value),
            max_retries: parseInt(document.getElementById('maxRetries').value)
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showNotification(data.message, 'success');
            document.getElementById('startScrapeBtn').disabled = true;
            document.getElementById('stopScrapeBtn').disabled = false;
            document.getElementById('scrapeStatusText').innerHTML = '<span class="badge bg-success">Running</span>';
            document.getElementById('scrapeProgress').style.display = 'block';
            startScrapeUpdates();
        } else {
            showNotification(data.message, 'error');
        }
    })
    .catch(error => {
        showNotification('Failed to start scraper: ' + error.message, 'error');
    });
}

function stopScraping() {
    if (!confirm('Are you sure you want to stop the current scraping session?')) {
        return;
    }
    
    fetch('/scraper/stop-scraping', {method: 'POST'})
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showNotification(data.message, 'success');
            stopScrapeUpdates();
            document.getElementById('startScrapeBtn').disabled = false;
            document.getElementById('stopScrapeBtn').disabled = true;
            document.getElementById('scrapeStatusText').innerHTML = '<span class="badge bg-warning">Stopping...</span>';
        } else {
            showNotification(data.message, 'error');
        }
    })
    .catch(error => {
        showNotification('Failed to stop scraper: ' + error.message, 'error');
    });
}

function startScrapeUpdates() {
    scrapeUpdateInterval = setInterval(() => {
        fetch('/scraper/api/stats')
        .then(response => response.json())
        .then(data => {
            updateLogsContainer(data.logs);
            
            if (data.current_session) {
                const session = data.current_session;
                document.getElementById('currentPage').textContent = session.current_page;
                document.getElementById('recordsScraped').textContent = session.records_scraped;
                
                const progress = ((session.current_page - session.start_page + 1) / session.pages_to_scrape) * 100;
                const progressPercentage = Math.min(Math.round(progress), 100);
                
                document.getElementById('progressBar').style.width = progressPercentage + '%';
                document.getElementById('progressPercentage').textContent = progressPercentage + '%';
                
                document.getElementById('scrapeStatusText').innerHTML = 
                    `<span class="badge bg-primary">Running</span>`;
            }

            if (!data.is_running) {
                stopScrapeUpdates();
                document.getElementById('startScrapeBtn').disabled = false;
                document.getElementById('stopScrapeBtn').disabled = true;
                document.getElementById('scrapeStatusText').innerHTML = '<span class="badge bg-success">Completed</span>';
                document.getElementById('scrapeProgress').style.display = 'none';
                setTimeout(() => location.reload(), 2000);
            }
        })
        .catch(error => {
            console.error('Error fetching scraper stats:', error);
        });
    }, 2000);
}

function stopScrapeUpdates() {
    if (scrapeUpdateInterval) {
        clearInterval(scrapeUpdateInterval);
        scrapeUpdateInterval = null;
    }
}

function updateLogsContainer(logs) {
    const logsContainer = document.getElementById('scrapeLogsContainer');
    
    if (logs && logs.length > 0) {
        const logsHtml = logs.map(log => {
            const levelClass = log.level.toLowerCase();
            const iconClass = getLogIcon(log.level);
            return `<div class="log-entry ${levelClass}"><i class="bi ${iconClass} me-2"></i>[${log.timestamp}] ${log.level}: ${log.message}</div>`;
        }).join('');
        
        logsContainer.innerHTML = logsHtml;
        
        if (autoScroll) {
            logsContainer.scrollTop = logsContainer.scrollHeight;
        }
    }
}

function getLogIcon(level) {
    switch(level.toLowerCase()) {
        case 'error': return 'bi-x-circle-fill';
        case 'warning': return 'bi-exclamation-triangle-fill';
        case 'success': return 'bi-check-circle-fill';
        case 'info': default: return 'bi-info-circle-fill';
    }
}

function clearScrapeLogs() {
    document.getElementById('scrapeLogsContainer').innerHTML = '<div class="log-entry info p-3 text-muted"><i class="bi bi-info-circle me-2"></i>Logs cleared...</div>';
}

function toggleAutoScroll() {
    autoScroll = !autoScroll;
    const btn = document.getElementById('autoScrollBtn');
    
    if (autoScroll) {
        btn.innerHTML = '<i class="bi bi-arrow-down me-1"></i>Auto-scroll';
        btn.classList.remove('btn-outline-primary');
        btn.classList.add('btn-primary');
    } else {
        btn.innerHTML = '<i class="bi bi-pause me-1"></i>Manual scroll';
        btn.classList.remove('btn-primary');
        btn.classList.add('btn-outline-primary');
    }
}

function toggleOption(optionId) {
    const checkbox = document.getElementById(optionId);
    const optionItem = checkbox.closest('.option-item');
    
    checkbox.checked = !checkbox.checked;
    
    if (checkbox.checked) {
        optionItem.classList.add('option-selected');
    } else {
        optionItem.classList.remove('option-selected');
    }
}

document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.option-item input[type="checkbox"]').forEach(checkbox => {
        const optionItem = checkbox.closest('.option-item');
        if (checkbox.checked) {
            optionItem.classList.add('option-selected');
        }
    });
});

function exportRecentData() {
    const source = document.getElementById('scraperType').value;
    const url = `{{ url_for('export_scraper_data') }}?source=${source}`;
    window.open(url, '_blank');
    showNotification('Export started', 'success');
}

function viewFailedSessions() {
    const modal = new bootstrap.Modal(document.getElementById('failedSessionsModal'));
    modal.show();
    
    fetch('/scraper/api/failed-sessions')
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            let content = '';
            if (data.sessions.length > 0) {
                content = `
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th class="border-0">Source</th>
                                    <th class="border-0">Pages</th>
                                    <th class="border-0">Records</th>
                                    <th class="border-0">Started</th>
                                    <th class="border-0">Error</th>
                                    <th class="border-0">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.sessions.map(session => `
                                    <tr class="session-row">
                                        <td><span class="badge ${session.source === 'adsy' ? 'bg-success' : 'bg-info'}">${session.source.toUpperCase()}</span></td>
                                        <td class="fw-medium">${session.start_page}-${session.start_page + session.pages_to_scrape - 1}</td>
                                        <td class="text-success fw-bold">${session.records_scraped}</td>
                                        <td class="small text-muted">${new Date(session.started_at).toLocaleString()}</td>
                                        <td class="small text-danger" title="${session.error_message || 'Unknown error'}">${(session.error_message || 'Unknown error').substring(0, 30)}${session.error_message && session.error_message.length > 30 ? '...' : ''}</td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-primary" onclick="retrySession(${session.id})" title="Retry Session">
                                                <i class="bi bi-arrow-clockwise"></i>
                                            </button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            } else {
                content = `
                    <div class="text-center py-5 empty-state">
                        <i class="bi bi-check-circle display-4 text-success mb-3"></i>
                        <h4 class="text-muted">No Failed Sessions</h4>
                        <p class="text-muted">All scraping sessions completed successfully!</p>
                    </div>
                `;
            }
            
            document.getElementById('failedSessionsContent').innerHTML = content;
        } else {
            document.getElementById('failedSessionsContent').innerHTML = `
                <div class="alert alert-danger">
                    <i class="bi bi-exclamation-triangle me-2"></i>Failed to load failed sessions
                </div>
            `;
        }
    })
    .catch(error => {
        document.getElementById('failedSessionsContent').innerHTML = `
            <div class="alert alert-danger">
                <i class="bi bi-x-circle me-2"></i>Error: ${error.message}
            </div>
        `;
    });
}

function retrySession(sessionId) {
    if (confirm('Retry this failed scraping session?')) {
        fetch('/scraper/retry-session', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({session_id: sessionId})
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showNotification(data.message, 'success');
                bootstrap.Modal.getInstance(document.getElementById('failedSessionsModal')).hide();
                setTimeout(() => location.reload(), 1000);
            } else {
                showNotification(data.message, 'error');
            }
        })
        .catch(error => {
            showNotification('Retry failed: ' + error.message, 'error');
        });
    }
}

function showNotification(message, type = 'info') {
    const alertClass = type === 'success' ? 'alert-success' : type === 'error' ? 'alert-danger' : type === 'warning' ? 'alert-warning' : 'alert-info';
    const iconClass = type === 'success' ? 'bi-check-circle' : type === 'error' ? 'bi-x-circle' : type === 'warning' ? 'bi-exclamation-triangle' : 'bi-info-circle';
    
    let flashContainer = document.querySelector('.flash-messages');
    if (!flashContainer) {
        flashContainer = document.createElement('div');
        flashContainer.className = 'flash-messages';
        document.body.appendChild(flashContainer);
    }
    
    const alert = document.createElement('div');
    alert.className = `alert ${alertClass} alert-dismissible fade show modern-alert`;
    alert.innerHTML = `
        <div class="alert-content">
            <i class="bi ${iconClass} me-2"></i>
            ${message}
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    flashContainer.appendChild(alert);
    
    setTimeout(() => {
        if (alert.parentNode) {
            const bsAlert = new bootstrap.Alert(alert);
            bsAlert.close();
        }
    }, 15000);
}

document.addEventListener('DOMContentLoaded', function() {
    const scrapeStatus = {{ 'true' if scraping_stats.is_running else 'false' }};
    
    if (scrapeStatus) {
        document.getElementById('startScrapeBtn').disabled = true;
        document.getElementById('stopScrapeBtn').disabled = false;
        document.getElementById('scrapeStatusText').innerHTML = '<span class="badge bg-primary">Running</span>';
        document.getElementById('scrapeProgress').style.display = 'block';
        startScrapeUpdates();
    }

    document.getElementById('scraperType').addEventListener('change', updateConfigSummary);
    document.getElementById('startPage').addEventListener('input', updateConfigSummary);
    document.getElementById('pagesToScrape').addEventListener('input', updateConfigSummary);

    document.querySelectorAll('.session-row').forEach(row => {
        row.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-1px)';
            this.style.boxShadow = 'var(--shadow-sm)';
        });
        
        row.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = '';
        });
    });

    updateConfigSummary();
});
</script>

<style>
.modern-card {
    border: none;
    border-radius: 12px;
    box-shadow: var(--shadow-sm);
    transition: all 0.2s ease;
}

.modern-card:hover {
    box-shadow: var(--shadow-md);
    transform: translateY(-2px);
}

.logs-terminal {
    background: #1e1e1e;
    color: #ffffff;
    font-family: 'Courier New', monospace;
    font-size: 0.85rem;
    line-height: 1.4;
    max-height: 400px;
    overflow-y: auto;
    padding: 0;
}

.log-entry {
    padding: 0.5rem 1rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    white-space: pre-wrap;
    word-break: break-word;
}

.log-entry.error {
    background-color: rgba(220, 53, 69, 0.1);
    color: #f8d7da;
    border-left: 3px solid #dc3545;
}

.log-entry.warning {
    background-color: rgba(255, 193, 7, 0.1);
    color: #fff3cd;
    border-left: 3px solid #ffc107;
}

.log-entry.success {
    background-color: rgba(25, 135, 84, 0.1);
    color: #d1e7dd;
    border-left: 3px solid #198754;
}

.log-entry.info {
    background-color: rgba(13, 110, 253, 0.1);
    color: #b6d4fe;
    border-left: 3px solid #0d6efd;
}

.logs-terminal::-webkit-scrollbar {
    width: 8px;
}

.logs-terminal::-webkit-scrollbar-track {
    background: #333;
}

.logs-terminal::-webkit-scrollbar-thumb {
    background: #666;
    border-radius: 4px;
}

.logs-terminal::-webkit-scrollbar-thumb:hover {
    background: #888;
}

.progress {
    height: 12px;
    border-radius: 6px;
    background-color: rgba(0, 0, 0, 0.1);
}

.progress-bar {
    border-radius: 6px;
    transition: width 0.3s ease;
}

.badge-sm {
    padding: 0.25rem 0.5rem;
    font-size: 0.75rem;
}

.options-section .option-item {
    padding: 0.75rem;
    border: 1px solid #e3e6f0;
    border-radius: 8px;
    transition: all 0.2s ease;
}

.options-section .option-item:hover {
    background-color: rgba(13, 110, 253, 0.05);
    border-color: var(--bs-primary);
}

.form-check-input:checked {
    background-color: var(--bs-primary);
    border-color: var(--bs-primary);
}

.sessions-table th {
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.75rem;
    letter-spacing: 0.5px;
    color: var(--bs-gray-700);
    padding: 0.75rem;
}

.session-row {
    transition: all 0.2s ease;
    border-left: 3px solid transparent;
}

.session-row:hover {
    background-color: rgba(13, 110, 253, 0.05);
    border-left-color: var(--bs-primary);
}

.empty-state {
    padding: 2rem;
}

.btn {
    transition: all 0.2s ease;
    border-radius: 8px;
    font-weight: 500;
}

.btn:hover {
    transform: translateY(-1px);
}

.btn:active {
    transform: translateY(0);
}

.btn:disabled {
    transform: none;
}

.card-header {
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    background: rgba(248, 249, 250, 0.8);
}

.modal-content {
    border: none;
    box-shadow: var(--shadow-lg);
    border-radius: 12px;
}

.form-control, .form-select {
    border-radius: 8px;
    border: 1px solid #e3e6f0;
    transition: all 0.2s ease;
}

.form-control:focus, .form-select:focus {
    border-color: var(--bs-primary);
    box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.1);
}

.input-group-text {
    border-color: #e3e6f0;
    background-color: #f8f9fa;
}

@media (max-width: 768px) {
    .modern-card:hover {
        transform: none;
    }
    
    .session-row:hover {
        transform: none;
    }
    
    .btn:hover {
        transform: none;
    }
    
    .modal-dialog {
        margin: 10px;
    }
    
    .logs-terminal {
        max-height: 250px;
        font-size: 0.75rem;
    }
    
    .card-body {
        padding: 1rem;
    }
    
    .options-section .option-item {
        padding: 0.5rem;
    }
    
    .table-responsive {
        font-size: 0.875rem;
    }
}

@media (max-width: 576px) {
    .row.g-4 {
        --bs-gutter-x: 0.75rem;
        --bs-gutter-y: 0.75rem;
    }
    
    .btn-group .btn {
        padding: 0.25rem 0.5rem;
        font-size: 0.75rem;
    }
    
    h5 {
        font-size: 1rem;
    }
    
    .badge-sm {
        padding: 0.2rem 0.4rem;
        font-size: 0.7rem;
    }
}

.option-item {
    padding: 1rem;
    border: 2px solid #e3e6f0;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.2s ease;
    background: white;
}

.option-item:hover {
    border-color: #b3d4fc;
    background-color: rgba(13, 110, 253, 0.02);
}

.option-item.option-selected {
    border-color: #0d6efd;
    background-color: rgba(13, 110, 253, 0.08);
    box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.1);
}

.option-check {
    width: 24px;
    height: 24px;
    border: 2px solid #dee2e6;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    background: white;
}

.option-selected .option-check {
    background-color: #0d6efd;
    border-color: #0d6efd;
    color: white;
}

.option-item:not(.option-selected) .option-check i {
    opacity: 0;
}

.option-selected .option-check i {
    opacity: 1;
}
</style>
{% endblock %}